<html>
<head>
  <title>Location PWA Test</title>
  <meta name="viewport" content="width=device-width">
  <meta name="apple-mobile-web-app-title" content="Location PWA">
  <link rel="manifest" href="/manifest.json" />
  
  <script type="text/javascript">
    function getLocation () {
      const promiseArray = []

      if (navigator.standalone) {
        promiseArray.push(new Promise((resolve, reject) => {
          const wait = setTimeout(() => {
            clearTimeout(wait)
            reject(new Error('Location has timed out'))
          }, 9000)
        }))
      }

      const getCurrentPositionPromise = new Promise((resolve, reject) => {
        if ('geolocation' in navigator) {
          navigator.geolocation.getCurrentPosition(resolve, reject, {
            timeout: 10000,
            maximumAge: 2000,
            enableHighAccuracy: false
          })
        } else {
          reject(new Error('Browser does not support geolocation!'))
        }
      })

      promiseArray.push(getCurrentPositionPromise)
      return Promise.race(promiseArray)
    }
      
    function test(){
      document.querySelector('pre').innerText = 'Testing...';
      getLocation().then(function(l){
        console.log('yup', l)
        document.querySelector('pre').innerText = 'Success: ' + l.coords.latitude + ', ' + l.coords.longitude;
      }).catch(function(e){
        console.log('nup', e)
        document.querySelector('pre').innerText = 'Error: ' + e.message;
      })
    }
  </script>
</head>
<body>
  <button onclick="test()">test</button>
  <hr>
  <pre></pre>
</body>
</html>
